import{_ as n,e as a,f as e,o as p}from"./app-CJFllaMF.js";const t={};function l(i,s){return p(),a("div",null,s[0]||(s[0]=[e(`<h1 id="api-object" tabindex="-1"><a class="header-anchor" href="#api-object"><span>API Object</span></a></h1><p>API Object Models，简称AOM，AOM是一种设计模式，它围绕着将API、路由或功能交互及其相关行为封装在结构良好的对象中。AOM旨在增强API测试和集成的直观性和弹性。在实践中，AOM需要精心设计专门的API对象，以有效地保护用户免受与API 请求、响应、端点交互和身份验证过程相关的复杂性的影响。</p><p>seldom 支持AOM, 并且提供了一些好用的功能，辅助你使用AOM.</p><ul><li>目录结构如下</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">mypro/</span>
<span class="line">├── api/</span>
<span class="line">│   ├── __init__.py</span>
<span class="line">│   ├── auth_object.py</span>
<span class="line">│   └── xxx_object.py</span>
<span class="line">├── test_dir/</span>
<span class="line">│   ├── test_auth.py</span>
<span class="line">│   └── test_xxx.py</span>
<span class="line">│  <span class="token punctuation">..</span>.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>创建 API Object</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># api/auth_object.py</span></span>
<span class="line"><span class="token keyword">from</span> seldom<span class="token punctuation">.</span>testdata <span class="token keyword">import</span> get_int</span>
<span class="line"><span class="token keyword">from</span> seldom<span class="token punctuation">.</span>request <span class="token keyword">import</span> HttpRequest</span>
<span class="line"><span class="token keyword">from</span> seldom<span class="token punctuation">.</span>request <span class="token keyword">import</span> check_response</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">AuthAPIObject</span><span class="token punctuation">(</span>HttpRequest<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> api_key<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>api_key <span class="token operator">=</span> api_key</span>
<span class="line"></span>
<span class="line">    <span class="token decorator annotation punctuation">@check_response</span><span class="token punctuation">(</span>ret<span class="token operator">=</span><span class="token string">&quot;form.token&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get_token</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_id<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">        模拟：根据用户ID生成登录token</span>
<span class="line">        :param user_id:</span>
<span class="line">        :return:</span>
<span class="line">        &quot;&quot;&quot;</span></span>
<span class="line">        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">:</span> user_id<span class="token punctuation">,</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;t&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>get_int<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        r <span class="token operator">=</span> self<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;/post?key=&quot;</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>api_key<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> r</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义API接口，根据<code>get_token()</code>用于生成token，这里我们通过随机数模拟的生成的token。<code>check_response()</code>装饰器用于装饰接口，<code>form.token</code> 用于提取API的返回值。</p><ul><li>创建测试用例</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># test_dir/test_auth.py</span></span>
<span class="line"><span class="token keyword">import</span> seldom</span>
<span class="line"><span class="token keyword">from</span> api<span class="token punctuation">.</span>auth_object <span class="token keyword">import</span> AuthAPIObject</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">TestAPI</span><span class="token punctuation">(</span>seldom<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test_case</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        auth_object <span class="token operator">=</span> AuthAPIObject<span class="token punctuation">(</span>api_key<span class="token operator">=</span><span class="token string">&quot;abc123&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        token <span class="token operator">=</span> auth_object<span class="token punctuation">.</span>get_token<span class="token punctuation">(</span>user_id<span class="token operator">=</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    seldom<span class="token punctuation">.</span>main<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> base_url<span class="token operator">=</span><span class="token string">&quot;https://httpbin.org&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在用例层调用<code>AuthAPIObject</code>类下面的对象，测试API。</p><ul><li>AOM 原则</li></ul><p>首先，API只允许通过的APIObject进行封装，那么在封装之前可以检索一下是否有封装了，如果有，进一步确认是否满足自己的调用需求，我们一般在测试API的时候一般各种参数验证，当API作为依赖接口调用的时候，一般参数比较少且固定，所以，API在封装的时候要兼顾到这两种情况。</p><p>其次，用例层只能通过APIObject的封装调用API，像登录token这种大部分API会用到的信息，可以通过类初始化时传入，后续调用类下面方法的时候就不需要关心的。如果是多个API组成一个场景，也可以再进行一层业务层的封装。</p>`,14)]))}const c=n(t,[["render",l],["__file","api_object.html.vue"]]),u=JSON.parse('{"path":"/api-testing/api_object.html","title":"API Object","lang":"en-US","frontmatter":{},"headers":[],"git":{"updatedTime":1709562134000,"contributors":[{"name":"defnngj","username":"defnngj","email":"defnngj@gmail.com","commits":2,"url":"https://github.com/defnngj"}],"changelog":[{"hash":"5b98bc53c0afc50869db74de3a6da4d932913a87","time":1709562134000,"email":"defnngj@gmail.com","author":"defnngj","message":"📝️ update api object doc"},{"hash":"b0f9b427fe5c57219681263e7b0460af8604d5de","time":1709484482000,"email":"defnngj@gmail.com","author":"defnngj","message":"📝️ api object doc"}]},"filePathRelative":"api-testing/api_object.md"}');export{c as comp,u as data};
